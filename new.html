<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr√≤ ch∆°i ƒêi·ªÉm s·ªë</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; }
        .hidden { display: none; }
        input, button { margin: 10px; padding: 10px; border: none; border-radius: 5px; cursor: pointer; }
        button { background-color: #007bff; color: white; }
        button:hover { background-color: #0056b3; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #f2f2f2; }

        /* Podium Styles */
        .podium { display: flex; justify-content: center; align-items: flex-end; margin: 20px 0; flex-wrap: wrap; }
        .rank { width: 120px; margin: 0 10px; text-align: center; border-radius: 10px; padding: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); transition: transform 0.3s; }
        .rank:hover { transform: scale(1.05); }
        .rank-1 { background-color: #FFD700; height: 150px; order: 2; }
        .rank-2 { background-color: #C0C0C0; height: 120px; order: 1; }
        .rank-3 { background-color: #CD7F32; height: 120px; order: 3; }
        .rank-other { background-color: #e9ecef; height: 100px; margin-top: 20px; width: 100%; }
        .rank h3 { margin: 0; font-size: 1.5em; }
        .rank p { margin: 5px 0; font-size: 1.2em; }
        .rank .icon { font-size: 2em; }
        .other-ranks { margin-top: 20px; }
        .other-ranks ul { list-style: none; padding: 0; }
        .other-ranks li { padding: 10px; margin: 5px 0; background-color: #fff; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

        /* History Styles */
        .history-container { display: flex; flex-direction: column; gap: 20px; }
        .history-card { background-color: #fff; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); padding: 20px; transition: transform 0.3s; }
        .history-card:hover { transform: translateY(-5px); }
        .history-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .history-header h3 { margin: 0; color: #333; }
        .history-summary { font-size: 0.9em; color: #666; }
        .history-details { margin-top: 15px; }
        .history-details table { margin-top: 10px; }
        .toggle-details { background-color: #28a745; color: white; margin-top: 10px; }
        .toggle-details:hover { background-color: #218838; }
        .delete-btn { background-color: #dc3545; color: white; }
        .delete-btn:hover { background-color: #c82333; }
        .clear-history { margin-top: 20px; background-color: #ffc107; color: black; }
        .clear-history:hover { background-color: #e0a800; }
		
		/* Updated Setup Styles for Better UI/UX */
        #setup {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            padding: 30px;
            max-width: 500px;
            margin: 0 auto;
            transition: transform 0.3s;
        }
        #setup:hover { transform: translateY(-5px); }
        #setup h2 { color: #007bff; text-align: center; margin-bottom: 20px; font-size: 1.8em; }
        .select-container {
            position: relative;
            margin-bottom: 20px;
        }
        .select-container::before {
            content: 'üë•';
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2em;
            pointer-events: none;
        }
        #numPlayers {
            width: 100%;
            padding: 12px 12px 12px 40px; /* Padding left for icon */
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
            background-color: #fff;
            transition: border-color 0.3s;
        }
        #numPlayers:focus { border-color: #007bff; outline: none; }
        .button-group {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }
        .button-group button {
            flex: 1;
            padding: 12px;
            font-size: 1em;
            border-radius: 5px;
            transition: background-color 0.3s, transform 0.2s;
        }
        .button-group button:hover { transform: scale(1.05); }
        .button-group button:first-child::before { content: 'üéÆ '; }
        .button-group button:last-child::before { content: 'üìú '; }

        @media (max-width: 600px) {
            .podium { flex-direction: column; align-items: center; }
            .rank { width: 100%; margin: 10px 0; }
            .history-header { flex-direction: column; align-items: flex-start; }
			#setup { padding: 20px; margin: 10px; }
            .button-group { flex-direction: column; }
            .button-group button { margin: 5px 0; }
        }
    </style>
</head>
<body>
    <h1>Tr√≤ ch∆°i ƒêi·ªÉm s·ªë</h1>

    <!-- Trang ch·ªçn s·ªë l∆∞·ª£ng ng∆∞·ªùi ch∆°i -->
    <div id="setup">
        <h2>Ch·ªçn s·ªë l∆∞·ª£ng ng∆∞·ªùi ch∆°i</h2>
        <select id="numPlayers">
            <option value="2">2 ng∆∞·ªùi</option>
            <option value="3">3 ng∆∞·ªùi</option>
            <option value="4">4 ng∆∞·ªùi</option>
            <option value="5">5 ng∆∞·ªùi</option>
        </select>
        <button onclick="startGame()">B·∫Øt ƒë·∫ßu</button>
        <button onclick="viewHistory()">Xem l·ªãch s·ª≠</button>
    </div>

    <!-- Trang nh·∫≠p t√™n ng∆∞·ªùi ch∆°i -->
    <div id="names" class="hidden">
        <h2>Nh·∫≠p t√™n ng∆∞·ªùi ch∆°i</h2>
        <div id="nameInputs"></div>
        <button onclick="submitNames()">Ti·∫øp t·ª•c</button>
    </div>

    <!-- Trang ch∆°i (Rounds) -->
    <div id="game" class="hidden">
        <h2>V√°n ch∆°i</h2>
        <table id="scoreTable"></table>
        <button onclick="nextRound()">Chuy·ªÉn v√°n ti·∫øp theo</button>
        <button onclick="endGame()">K·∫øt th√∫c tr√≤ ch∆°i</button>
    </div>

    <!-- Trang k·∫øt qu·∫£ -->
    <div id="results" class="hidden">
        <h2>K·∫øt qu·∫£ cu·ªëi c√πng</h2>
        <div id="podiumContainer"></div>
        <div class="other-ranks" id="otherRanks"></div>
        <button onclick="resetGame()">Ch∆°i l·∫°i</button>
    </div>

    <!-- L·ªãch s·ª≠ tr√≤ ch∆°i -->
    <div id="history" class="hidden">
        <h2>üìúL·ªãch s·ª≠ tr√≤ ch∆°i</h2>
		<button class="clear-history" onclick="clearAllHistory()">X√≥a t·∫•t c·∫£ l·ªãch s·ª≠</button>
        <button onclick="backToHome()">Quay l·∫°i trang ch√≠nh</button>
        <div class="history-container" id="historyList"></div>
        
    </div>

    <script>
        let players = [];
        let scores = [];
        let round = 1;
        let gameHistory = JSON.parse(localStorage.getItem('gameHistory')) || [];

        function startGame() {
            const num = parseInt(document.getElementById('numPlayers').value);
            document.getElementById('setup').classList.add('hidden');
            document.getElementById('names').classList.remove('hidden');
            const nameInputs = document.getElementById('nameInputs');
            nameInputs.innerHTML = '';
            for (let i = 0; i < num; i++) {
                nameInputs.innerHTML += `<input type="text" placeholder="T√™n ng∆∞·ªùi ch∆°i ${i+1}" id="player${i}">`;
            }
        }

        function submitNames() {
            const num = parseInt(document.getElementById('numPlayers').value);
            players = [];
            for (let i = 0; i < num; i++) {
                const name = document.getElementById(`player${i}`).value || `Ng∆∞·ªùi ch∆°i ${i+1}`;
                players.push(name);
                scores.push([]); // M·∫£ng ƒëi·ªÉm cho m·ªói ng∆∞·ªùi
            }
            document.getElementById('names').classList.add('hidden');
            document.getElementById('game').classList.remove('hidden');
            renderScoreTable();
        }

        function renderScoreTable() {
            const table = document.getElementById('scoreTable');
            table.innerHTML = '';
            // H√†ng t√™n ng∆∞·ªùi ch∆°i
            let headerRow = '<tr><th>V√°n</th>';
            players.forEach(name => {
                headerRow += `<th>${name}</th>`;
            });
            headerRow += '</tr>';
            table.innerHTML += headerRow;
            // H√†ng cho v√°n hi·ªán t·∫°i (v·ªõi input)
            let currentRow = `<tr><td>V√°n ${round}</td>`;
            players.forEach((_, index) => {
                currentRow += `<td><input type="number" id="score${index}" placeholder="ƒêi·ªÉm"></td>`;
            });
            currentRow += '</tr>';
            table.innerHTML += currentRow;
        }

        function nextRound() {
            // L∆∞u ƒëi·ªÉm v√°n hi·ªán t·∫°i
            players.forEach((_, index) => {
                const score = parseInt(document.getElementById(`score${index}`).value) || 0;
                scores[index].push(score);
            });
            // Chuy·ªÉn input th√†nh text read-only
            const table = document.getElementById('scoreTable');
            const rows = table.rows;
            const lastRow = rows[rows.length - 1];
            for (let i = 1; i < lastRow.cells.length; i++) { // B·ªè qua c·ªôt "V√°n"
                const input = lastRow.cells[i].querySelector('input');
                if (input) {
                    lastRow.cells[i].innerHTML = input.value || '0';
                }
            }
            // TƒÉng round v√† th√™m h√†ng m·ªõi
            round++;
            let newRow = `<tr><td>V√°n ${round}</td>`;
            players.forEach((_, index) => {
                newRow += `<td><input type="number" id="score${index}" placeholder="ƒêi·ªÉm"></td>`;
            });
            newRow += '</tr>';
            table.innerHTML += newRow;
        }

        function endGame() {
            // L∆∞u ƒëi·ªÉm v√°n cu·ªëi c√πng
            players.forEach((_, index) => {
                const score = parseInt(document.getElementById(`score${index}`).value) || 0;
                scores[index].push(score);
            });
            // T√≠nh t·ªïng ƒëi·ªÉm
            const totals = scores.map(playerScores => playerScores.reduce((a, b) => a + b, 0));
            // S·∫Øp x·∫øp th·ª© h·∫°ng
            const ranked = players.map((name, index) => ({ name, total: totals[index] }))
                .sort((a, b) => b.total - a.total);
            // Render podium
            renderPodium(ranked);
            // L∆∞u l·ªãch s·ª≠
            const gameData = {
                time: new Date().toLocaleString(),
                players: players,
                scores: scores,
                totals: totals
            };
            gameHistory.push(gameData);
            localStorage.setItem('gameHistory', JSON.stringify(gameHistory));
            // Chuy·ªÉn trang
            document.getElementById('game').classList.add('hidden');
            document.getElementById('results').classList.remove('hidden');
        }

        function renderPodium(ranked) {
            const podiumContainer = document.getElementById('podiumContainer');
            const otherRanks = document.getElementById('otherRanks');
            podiumContainer.innerHTML = '';
            otherRanks.innerHTML = '';

            // Podium cho top 3
            const podiumRanks = ranked.slice(0, 3);
            podiumRanks.forEach((player, index) => {
                const rankClass = index === 0 ? 'rank-1' : index === 1 ? 'rank-2' : 'rank-3';
                const icon = index === 0 ? 'üèÜ' : index === 1 ? 'ü•à' : 'ü•â';
                const title = index === 0 ? 'Nh√† v√¥ ƒë·ªãch' : index === 1 ? '√Å qu√¢n' : 'H·∫°ng ba';
                podiumContainer.innerHTML += `
                    <div class="rank ${rankClass}">
                        <div class="icon">${icon}</div>
                        <h3>${player.name}</h3>
                        <p>${player.total} ƒëi·ªÉm</p>
                        <p><strong>${title}</strong></p>
                    </div>
                `;
            });

            // C√°c h·∫°ng c√≤n l·∫°i
            if (ranked.length > 3) {
                otherRanks.innerHTML = '<h3>C√°c h·∫°ng kh√°c</h3><ul>';
                ranked.slice(3).forEach((player, index) => {
                    otherRanks.innerHTML += `<li>H·∫°ng ${index + 4}: ${player.name} - ${player.total} ƒëi·ªÉm</li>`;
                });
                otherRanks.innerHTML += '</ul>';
            }
        }

        function resetGame() {
            players = [];
            scores = [];
            round = 1;
            document.getElementById('results').classList.add('hidden');
            document.getElementById('setup').classList.remove('hidden');
        }

        function showHistory() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';
            // S·∫Øp x·∫øp theo th·ªùi gian g·∫ßn nh·∫•t
            gameHistory.sort((a, b) => new Date(b.time) - new Date(a.time));
            gameHistory.forEach((game, index) => {
                const maxScore = Math.max(...game.totals);
                const winner = game.players[game.totals.indexOf(maxScore)];
                historyList.innerHTML += `
                    <div class="history-card">
                        <div class="history-header">
                            <h3>üìÖ ${game.time}</h3>
                            <button class="delete-btn" onclick="deleteGame(${index})">X√≥a</button>
                        </div>
                        <div class="history-summary">
                            <p>üèÜ Ng∆∞·ªùi th·∫Øng: ${winner} (${maxScore} ƒëi·ªÉm) | S·ªë ng∆∞·ªùi ch∆°i: ${game.players.length}</p>
                        </div>
                        <button class="toggle-details" onclick="toggleDetails(${index})">Xem chi ti·∫øt ƒëi·ªÉm</button>
                        <div class="history-details" id="details-${index}" style="display: none;">
                            <table>
                                <tr><th>T√™n</th><th>ƒêi·ªÉm t·ª´ng v√°n</th><th>T·ªïng ƒëi·ªÉm</th></tr>
                                ${game.players.map((name, i) => `<tr><td>${name}</td><td>${game.scores[i].join(', ')}</td><td>${game.totals[i]}</td></tr>`).join('')}
                            </table>
                        </div>
                    </div>
                `;
            });
        }

        function toggleDetails(index) {
            const details = document.getElementById(`details-${index}`);
            details.style.display = details.style.display === 'none' ? 'block' : 'none';
        }

        function deleteGame(index) {
            gameHistory.splice(index, 1);
            localStorage.setItem('gameHistory', JSON.stringify(gameHistory));
            showHistory();
        }

        function clearAllHistory() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t·∫•t c·∫£ l·ªãch s·ª≠?')) {
                gameHistory = [];
                localStorage.removeItem('gameHistory');
                showHistory();
            }
        }

        function backToHome() {
            document.getElementById('history').classList.add('hidden');
            document.getElementById('setup').classList.remove('hidden');
        }

        function viewHistory() {
            document.getElementById('setup').classList.add('hidden');
            document.getElementById('history').classList.remove('hidden');
            showHistory();
        }
    </script>
</body>
</html>